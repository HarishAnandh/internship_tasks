CODES SQL
1.CREATE TABLE student(id int,name varchar(30),dname varchar(30),cred int,FOREIGN KEY(id) REFERENCES takes(id));
2.ALTER TABLE takes ADD CONSTRAINT id UNIQUE (id);
3.CREATE TABLE instructor(id int,name varchar(30),dname varchar(30),salary int,FOREIGN KEY(dname) REFERENCES course(dname),FOREIGN KEY(id) REFERENCES advisor(aid));
4.CREATE TABLE advisor(aid int,iid int,PRIMARY KEY(aid),UNIQUE(iid));
5.CREATE TABLE department(dname varchar(30),building int,budget int,FOREIGN KEY(dname) REFERENCES course(dname));
5.CREATE TABLE course(cid int,title varchar(30),dname varchar(30),credits int,FOREIGN KEY(cid) REFERENCES prereq(cid),PRIMARY KEY(dname));
6.CREATE TABLE prereq(cid int,pid int, PRIMARY KEY(cid),UNIQUE(pid));
7.CREATE TABLE time(tid int,day varchar(30),FOREIGN KEY(tid) REFERENCES section(tid));
8.CREATE TABLE classroom(building int,rno int,capacity int,FOREIGN KEY(building,rno) REFERENCES section(building,rno));
9.CREATE TABLE section( cid int, sid int, semester int,year int,building int,rno int,tid int,PRIMARY KEY(building,rno),UNIQUE(tid),FOREIGN KEY (cid, sid, semester, year) REFERENCES takes(cid, sid, semester, year));
10.CREATE TABLE teachers(id int,cid int,sid int,semester int,year int,PRIMARY KEY(id,cid,sid,semester,year));
11.CREATE TABLE advisor(aid int,iid int,PRIMARY KEY(aid,iid));
12.CREATE TABLE takes(id int, cid int,sid int,semester int,year int,grade int,PRIMARY KEY(cid,sid,semester,year));
BASIC
SELECT name
FROM student
WHERE tot_cred > 100;

SELECT t.course_id, t.grade
FROM student s
JOIN takes t ON s.ID = t.ID
WHERE s.name = 'Tanaka';

SELECT DISTINCT i.ID, i.name
FROM instructor i
JOIN teaches te ON i.ID = te.ID
JOIN course c ON te.course_id = c.course_id
WHERE c.dept_name = 'Comp. Sci.';
SELECT DISTINCT c.course_id, c.title
FROM course c
WHERE c.course_id IN (
    SELECT course_id
    FROM section
    WHERE semester = 'Fall'
)
AND c.course_id IN (
    SELECT course_id
    FROM section
    WHERE semester = 'Spring'
);

SELECT name
FROM instructor
WHERE dept_name = 'Comp. Sci.';
SELECT DISTINCT c.course_id, c.title
FROM instructor i
JOIN teaches t ON i.ID = t.ID
JOIN course c ON t.course_id = c.course_id
WHERE i.name = 'Srinivasan';
SELECT DISTINCT i.name
FROM instructor i
JOIN teaches t ON i.ID = t.ID
WHERE t.semester = 'Spring' AND t.year = 2009;
SELECT DISTINCT c.course_id, c.title
FROM instructor i
JOIN teaches t ON i.ID = t.ID
JOIN course c ON t.course_id = c.course_id
WHERE i.name = 'Srinivasan';
INTERMEDIATE
SELECT COUNT(*) AS num_instructors
FROM instructor i
WHERE NOT EXISTS (
    SELECT 1 FROM teaches t WHERE i.ID = t.ID
);
INSERT INTO instructor VALUES ('99999', 'Test_Instructor', 'Physics', 60000);
SELECT building, SUM(capacity) AS total_capacity
FROM classroom
GROUP BY building;
SELECT building, SUM(capacity) AS total_capacity
FROM classroom
GROUP BY building;
SELECT MAX(teacher_count) AS max_teachers
FROM (
    SELECT course_id, sec_id, semester, year, COUNT(ID) AS teacher_count
    FROM teaches
    GROUP BY course_id, sec_id, semester, year
) AS temp;
SELECT d.dept_name, COUNT(i.ID) AS num_instructors
FROM department d
LEFT JOIN instructor i ON d.dept_name = i.dept_name
GROUP BY d.dept_name
ORDER BY num_instructors DESC;
SELECT s.ID, s.name, SUM(c.credits) AS total_completed_credits
FROM student s
JOIN takes t ON s.ID = t.ID
JOIN course c ON t.course_id = c.course_id
WHERE t.grade IS NOT NULL AND t.grade <> 'F'
GROUP BY s.ID, s.name;
SELECT COUNT(DISTINCT t.ID) AS num_students
FROM takes t
JOIN teaches te ON t.course_id = te.course_id
                AND t.sec_id = te.sec_id
                AND t.semester = te.semester
                AND t.year = te.year
JOIN instructor i ON te.ID = i.ID
WHERE i.name = 'Srinivasan';

SELECT i.name, i.dept_name, i.salary
FROM instructor i
WHERE i.salary = (
    SELECT MAX(i2.salary)
    FROM instructor i2
    WHERE i2.dept_name = i.dept_name
);
WITH SrinivasanCourses AS (
    SELECT DISTINCT t.course_id
    FROM teaches t
    JOIN instructor i ON t.ID = i.ID
    WHERE i.name = 'Srinivasan'
)
SELECT s.ID, s.name
FROM student s
WHERE NOT EXISTS (
    SELECT course_id
    FROM SrinivasanCourses sc
    WHERE NOT EXISTS (
        SELECT 1
        FROM takes t
        WHERE t.ID = s.ID
          AND t.course_id = sc.course_id
    )
);
SELECT dept_name, SUM(salary) AS total_salary
FROM instructor
GROUP BY dept_name;
WITH CourseCounts AS (
    SELECT i.ID, COUNT(DISTINCT t.course_id) AS num_courses
    FROM instructor i
    JOIN teaches t ON i.ID = t.ID
    GROUP BY i.ID
),
MaxInstructor AS (
    SELECT ID
    FROM CourseCounts
    WHERE num_courses = (SELECT MAX(num_courses) FROM CourseCounts)
)
SELECT s.name
FROM student s
JOIN advisor a ON s.ID = a.s_ID
WHERE a.i_ID IN (SELECT ID FROM MaxInstructor);
---------------------------------------------------
SELECT sname,sid+year s12 FROM student;
SELECT sname s12 FROM student;
SELECT sname AS bros,sid AS age FROM student;
SELECT sname AS "ITBK" FROM student;
SELECT sname,sid AS "ITBK" FROM student;
SELECT * FROM student AS boys;
SELECT sname,age AS "The Boys" FROM student WHERE sid >121;
SELECT sname,age AS "The Boys" FROM student WHERE sid BETWEEN 100 AND 121;
SELECT rollno,total,avg FROM marks FETCH FIRST 10 ROWS ONLY;
SELECT rollno FROM marks GROUP BY rollno;
SELECT rollno,s1 FROM marks GROUP BY rollno,s1;
SELECT min(rollno),max(s1) FROM marks GROUP BY rollno,s1;


SELECT p1.age,s1.crowd FROM population p1 JOIN security s1 ON p1.people = s1.crowd;
SELECT * FROM officers f LEFT JOIN ministers m ON m.location = f.location;
SELECT * FROM officers f RIGHT JOIN ministers m ON m.location = f.location;
SELECT * FROM officers f INNER JOIN ministers m ON m.location = f.location;
SELECT * FROM population CROSS JOIN security;
SELECT p1.age,s1.crowd FROM population p1 JOIN security s1 ON p1.people = s1.crowd;
SELECT * FROM MINISTERS NATURAL JOIN OFFICERS;
SELECT location FROM ministers UNION SELECT location FROM officers;
SELECT location FROM ministers UNION ALL SELECT location FROM officers;
SELECT location FROM ministers UNION DISTINCT SELECT location FROM officers;
SELECT location FROM ministers INTERSECT SELECT location FROM officers;
SELECT location FROM ministers INTERSECT ALL SELECT location FROM officers;
SELECT location FROM ministers EXCEPT SELECT location FROM officers;
SELECT location FROM ministers EXCEPT ALL SELECT location FROM officers;
SELECT location FROM officers EXCEPT ALL SELECT location FROM ministers;
SELECT location FROM officers WHERE EXISTS ( SELECT location FROM ministers WHERE ministers.location = officers.location);
SELECT location FROM officers WHERE EXISTS ( SELECT location FROM ministers WHERE ministers.mid > officers.id);
SELECT location FROM officers WHERE NOT EXISTS ( SELECT location FROM ministers WHERE ministers.mid > officers.id);
SELECT location FROM officers WHERE NOT EXISTS ( SELECT location FROM ministers WHERE ministers.mid < officers.id);
SELECT * FROM ministers m WHERE m.location IN (SELECT location FROM officers) ;
SELECT m.name,f.count FROM ministers m INNER JOIN officers f ON m.location IN (SELECT location FROM officers f) ;
SELECT m.name,f.count FROM ministers m INNER JOIN officers f ON m.location IN (SELECT location FROM officers f) ;
SELECT p.age,p.location FROM population p WHERE p.people > (SELECT SUM(crowd) FROM security s);
SELECT p.age,p.location FROM population p INNER JOIN security s ON p.people > (SELECT SUM(crowd) FROM security s);
SELECT p.age,p.location,s.name FROM population p INNER JOIN security s ON p.people > (SELECT SUM(crowd) FROM security s);
SELECT p.age,p.location,s.name FROM security s INNER JOIN population p ON s.crowd > (SELECT AVG(people) FROM population p);
SELECT p.age,p.location,s.name FROM security s LEFT JOIN population p ON s.crowd > (SELECT AVG(people) FROM population p);
SELECT p.age,p.location,s.name FROM security s RIGHT JOIN population p ON s.crowd > (SELECT AVG(people) FROM population p);
SELECT p.age,p.location,s.name FROM security s JOIN population p ON s.crowd > (SELECT AVG(people) FROM population p);








CREATE TABLE departments(did int PRIMARY KEY,dname varchar(100) UNIQUE NOT NULL);
CREATE TABLE employees(eid int PRIMARY KEY,fname varchar(30),lname varchar(30),did int REFERENCES departments(did), salary NUMERIC(10,2), hire_date DATE DEFAULT CURRENT_DATE);
1.CREATE PROCEDURE insertdept(p_did IN INT,p_dname IN VARCHAR(100)) LANGUAGE plpgsql AS $$ BEGIN INSERT INTO DEPARTMENTS (did ,dname) VALUES (p_did , p_dname);
END;
$$;
CALL insertdept(108,'civil');
CREATE OR REPLACE FUNCTION getempbydname(deptname TEXT)
 RETURNS TABLE (eid INT,fname TEXT, lname TEXT, did int)AS $$
 BEGIN
 RETURN QUERY
 SELECT e.eid,e.fname,e.lname,d.dname
 FROM employees e
 JOIN departments d ON e.did = d.did
WHERE d.dname = deptname;
END;
 $$ LANGUAGE plpgsql;
2.CREATE OR REPLACE FUNCTION getempbydname(deptname VARCHAR(30))
RETURNS TABLE (
    eid INT,
    fname VARCHAR(50),
    lname VARCHAR(50)
)
LANGUAGE plpgsql
AS $$
BEGIN
    RETURN QUERY
    SELECT e.eid, e.fname, e.lname
    FROM employees e
    JOIN departments d ON e.did = d.did
    WHERE d.dname = deptname;
END;
$$;
3.CREATE OR REPLACE PROCEDURE salaryhike10(deptname VARCHAR(30))
LANGUAGE plpgsql
AS $$
BEGIN
UPDATE employees e SET salary = 1.1 * salary FROM departments d WHERE d.did  = e.did AND d.dname = deptname;
END;
$$;
CREATE OR REPLACE FUNCTION newemp(empid INT , f_name VARCHAR(30), l_name VARCHAR(30),deptid INT ,esalary INT , edate date)
LANGUAGE plpgsql
AS $$
BEGIN
INSERT INTO employees(eid,fname, lname, did, hire_date)VALUES (empid, f_name, l_name, deptid,esalary,edate);
END;
$$;
CREATE OR REPLACE FUNCTION newemp(empid INT , f_name VARCHAR(30), l_name VARCHAR(30),deptid INT ,esalary int , edate date) RETURNS VOID AS $$
 BEGIN
INSERT INTO employees(eid,fname, lname, did,salary, hire_date)VALUES (empid, f_name, l_name, deptid,esalary,edate);
 END;
$$ LANGUAGE plpgsql;
--------------------------------------
triggers
 CREATE TABLE employee(eid int primary key,name varchar(100),salary decimal(10,2) );
 CREATE TABLE audit(lid serial primary key, action varchar(50), adate timestamp default current_timestamp, details VARCHAR(255));


create or replace function auditlog() returns  trigger as $$
 begin
 insert into audit (action,adate,details) values ('INSERTED',current_timestamp,current_user);
 return new;
 end;
 $$ language plpgsql;
CREATE FUNCTION
 create trigger adduser after
 insert on employee
 for each row
 execute function auditlog();
CREATE TRIGGER
INSERT INTO employee VALUES (2024115099, 'Harish Anandh', 104000);
 create or replace function auditlog1() returns trigger as $$
begin
insert into audit(action, adate,details) values ('INSERTED',current_date,new.name);
 return new;
 end;
 $$ language plpgsql;
 create trigger upuser after
 insert on employee
 for each row
 execute function auditlog1();
CREATE TRIGGER
 INSERT INTO employee VALUES (2024115097,'ruba',100000);
INSERT 0 1
 create or replace function auditlog3() returns trigger as $$
 begin
 if NEW.salary < OLD.salary THEN
  RAISE EXCEPTION 'NEW SALARY LESS THAN OLD SALARY';
 END IF;
 return new;
 end;
 $$ language plpgsql;
CREATE FUNCTION
 create trigger insteadof_update before update on employee
for each row
 execute function auditlog3();
CREATE TRIGGER
select * from employee;




